# 自定义

## 自定义说明

当前插件具有的自定义功能包含自定义群通知、自定义菜单、自定义指令、自定义任务，后期会考虑增加更多自定义功能，敬请期待！

## 自定义变量

:::tip

- 编辑时会自动将换行键转换为 [换行]
- 使用变量时一定要记得带上中括号 []
- 自定义任务和自定义指令均支持以下变量
- 系统变量仅VIP版可用
- VIP版支持[DR码](../framework/code.md)关键词匹配，即可通过表情、图片等触发相应指令

:::

#### 框架变量

- [DR码](../framework/code.md)

#### 应用变量

|变量名称|变量参数|示例|示例说明|
|:-------|:-------|:-------|:-------|
|群号|无|[群号]|返回本次会话群号|
|用户号|无|[用户号]|返回本次会话用户号|
|@用户号|无|[@用户号]|艾特本次会话用户|
|头像|无|[头像]|返回本次会话用户头像|
|消息|无|[消息]|返回本次会话用户发送的消息|
|签到次数|无|[签到次数]|返回本次会话用户签到次数|
|现金总数|无|[现金总数]|返回本次会话用户现金总数|
|存款总数|无|[存款总数]|返回本次会话用户存款总数|
|魅力总数|无|[魅力总数]|返回本次会话用户魅力总数|
|体力总数|无|[体力总数]|返回本次会话用户体力总数|
|奖券总数|无|[奖券总数]|返回本次会话用户奖券总数|


#### 系统变量

|变量名称|变量参数|示例|示例说明|
|:-------|:-------|:-------|:-------|
|如果|p1：结束标识，p2：判断条件，p3：条件满足时返回内容，p4：条件不满足时返回内容|`[如果 p1,p2] p3 [p1假] p4 [p1]`|判断条件成立，返回p3，判断条件不成立，返回p4|
|如果真|p1：结束标识，p2：判断条件，p3：条件满足时返回内容|`[如果真 p1,p2] p3 [p1]`|判断条件成立，返回p3，判断条件不成立，返回空文本|
|循环|p1：结束标识，p2：循环次数，p3：要循环的文本，可使用变量：[p1次数]、[跳出循环]、[到循环尾]|`[循环 p1,p2 ] p3  [p1]`|按p2循环次数循环输出文本p3|
|换行|无|`[换行]`|返回换行|
|随机表情|无|`[随机表情]`|返回随机表情|
|重启应用|无|`[重启应用]`|重启梦幻应用|
|热门文字|p1：文本类型：笑话、心灵鸡汤、舔狗日记、冷知识、抽签|`[热门文字鸡汤]`|返回笑话|
|热门图片|p1：图片类型：性感、美女、帅哥、动漫、古风、风景、萌宠、恶搞、男生头像、女生头像、男漫头像、女漫头像|`[热门图片美女]`|返回美女图片|
|现行日期|无|`[现行日期]`|返回当前日期|
|现行时间|无|`[现行时间]`|返回当前时间|
|取随机数|p1：欲取随机数的最小值，p2：欲取随机数的最大值|`[取随机数1,100]`|返回1~100之间的随机数|
|取运行目录|无|`[取运行目录]`|返回当前程序运行目录|
|创建目录|p1：欲创建的目录名称|`[创建目录D:\directory]`|创建指定目录|
|写配置项|p1：配置文件名，p2：节名称，p3：配置项名称，可空，p4：欲写入值，可空|`[写配置项D:\config.ini,section,key,value]`|写指定配置值到指定配置文件|
|读配置项|p1：配置文件名，p2：节名称，p3：配置项名称，p4：默认文本，可空|`[读配置项D:\config.ini,section,key]`|读取指定配置文件配置值|
|网页访问|p1：网址，p2：访问方式，可空，p3：提交信息，可空，p4：附加协议头，可空，p5：提交Cookies，可空|`[网页访问https://open.drea.cc/bbsapi/chat/get,1,keyWord=Hello]`|返回网页访问内容|
|取文本之间|p1：被搜寻的文本，p2：开始文本，p3：结束文本|`[取文本之间我爱你,我,你]`|返回取文本之间的文本|
|括号计算|p1：算式|`[括号计算(520+1314000)*1]`|返回算式计算结果|
|正则匹配|p1：目标文本，p2：[正则表达式](https://www.baidu.com/s?wd=正则表达式)|`[正则匹配我爱你,.*爱.*]`|返回正则匹配结果|

## 自定义指令

#### 2.1 自定义指令是什么？

实质上是指自定义关键词回复，即用户为机器人设置一系列的关键词回复，当触发关键词时，机器人会自动回复用户定义的内容，指令关键词和回复支持众多[变量](#自定义说明)！

#### 2.2 关键词各匹配模式之间有何不同？

本指令系统支持关键词三种匹配模式，完整匹配是指只有当用户发送的内容完全和关键词匹配上时才会触发回复；模糊匹配是指只要用户发送的内容里面包含有关键词就会触发回复；正则匹配是指只要用户发送的内容刚好符合关键词上定义的正则表达式就会触发回复。

#### 2.3 正则表达式是什么？

正则表达式，又称规则表达式，通常被用来检索、替换那些符合某个模式(规则)的文本。本指令系统采用强大正则表达式作为关键词匹配引擎，可以更加精准的实现关键词的匹配。

#### 2.4 正则表达式定义示例？

[ 示例一 ]
`(为什么|怎么办|有问题)`
完整匹配为什么、怎么办、有问题这三条语句中的任意一条

[ 示例二 ]
`.*(为什么|怎么办|有问题).*`
模糊匹配为什么、怎么办、有问题这三条语句中的任意一条

[ 示例三 ]
`.*(早上|中午|下午)好.*`
模糊匹配早上好、中午好、下午好这三条语句中的任意一条

[ 示例四 ]
`.*如果.*那么.*`
模糊匹配句子中包含如果和那么的语句

[ 示例五 ]
`.*\d+.*`
只要语句中包含数字就会匹配上

#### 2.5 默认指令配置

指令配置.ini
```ini
[几点了]
匹配模式=模糊
优先级=1
回复内容=现在是北京时间[现行时间]
[.*(谁最帅|谁最美).*]
匹配模式=正则
优先级=1
回复内容=自古多情空余恨，此恨绵绵无绝期。试问世间情为何物，直教生死相许。试问本群谁最帅，非群主莫属！天下无双，眉清目秀，英俊潇洒，风流倜傥，玉树临风，风度翩翩美少年！
[指令测试]
匹配模式=模糊
优先级=5
回复内容=艾特用户号：[@用户号][换行]换行：[换行][换行]群号：[群号][换行]用户号：[用户号][换行]头像：[头像][换行]随机表情：[随机表情][换行]签到次数：[签到次数][换行]现金总数：[现金总数][换行]存款总数：[存款总数][换行]体力总数：[体力总数][换行]魅力总数：[魅力总数][换行]奖券总数：[奖券总数][换行]现行日期：[现行日期][换行]现行时间：[现行时间][换行]笑话：[笑话][换行]鸡汤：[鸡汤][换行]冷知识：[冷知识][换行]舔狗日记：[舔狗日记][换行]美女图片：[美女图片][换行][换行]温馨提示：本指令仅用于测试，普通版仅可使用部分变量。
```

**2.6 温馨提示**

更多[正则表达式](https://www.baidu.com/s?wd=正则表达式)的定义规范请自行百度！

## 自定义任务

#### 3.1 自定义任务是什么？

实质上是指自定义定时任务，即用户可自行定义机器人每天在固定时间，或每隔一定时长执行指定任务，任务回复支持众多[变量](#自定义说明)！

#### 3.2 cron表达式是什么？

cron全称为crontab，是定时任务中定时器的一种定义规范，用于设置周期性被执行的指令，本任务系统采用强大的cron表达式作为定时器的定义规范，可以更加精准的实现定时任务的定义。

#### 3.3 cron定时器定义示例？

[ 示例一 ]
`0 0 */1 * * *`
每整点 执行一次

[ 示例二 ]
`*/5 * * * * *`
每5秒钟 执行一次

[ 示例三 ]
`0 */5 * * * *`
每5分钟 执行一次

[ 示例四 ]
`0 0 */5 * * *`
每5小时 执行一次

[ 示例五 ]
`0 0 7-23 * * *`
每天7点到23点期间，每整点执行一次

[ 示例六 ]
`0 30 12,14,16 * * *`
每天12:30、14:30、16:30各执行一次

[ 示例七 ]
`0 15 10 * * MON-FRI`
每周一至周五的上午10:15执行一次

#### 3.4 默认任务配置

任务配置.ini
```ini
[任务测试]
cron=0 */10 * * * *
任务内容=群号：[群号][换行]换行：[换行][换行]随机表情：[随机表情][换行]现行日期：[现行日期][换行]现行时间：[现行时间][换行]笑话：[笑话][换行]鸡汤：[鸡汤][换行]冷知识：[冷知识][换行]舔狗日记：[舔狗日记][换行]美女图片：[美女图片][换行][换行]温馨提示：本任务仅用于测试，普通版仅可使用部分变量。
启停状态=0
[早上提醒]
cron=0 0 8 * * *
任务内容=现在是北京时间 [现行时间][换行][换行]早上好，记得早点吃饭哦～
启停状态=1
[上午提醒]
cron=0 0 10 * * *
任务内容=现在是北京时间 [现行时间][换行][换行]上午好，又是元气满满的一天呢～[换行][换行][鸡汤]
启停状态=1
[中午提醒]
cron=0 0 12 * * *
任务内容=现在是北京时间 [现行时间][换行][换行]中午好，记得早点吃饭哦～
启停状态=1
[下午提醒]
cron=0 0 15 * * *
任务内容=现在是北京时间 [现行时间][换行][换行]下午好，感觉疲惫了吗？起来活动活动呗～[换行][换行][笑话]
启停状态=1
[傍晚提醒]
cron=0 0 18 * * *
任务内容=现在是北京时间 [现行时间][换行][换行]傍晚好，记得早点吃饭哦～
启停状态=1
[晚上提醒]
cron=0 0 21 * * *
任务内容=现在是北京时间 [现行时间][换行][换行]晚上好，吾日三省吾身，为人谋而不忠乎？与朋友交而不信乎？传不习乎？[换行][换行][鸡汤]
启停状态=1
[凌晨提醒]
cron=0 0 0 * * *
任务内容=现在是北京时间 [现行时间][换行][换行]夜深了，早点休息哦～[换行][换行][舔狗日记]
启停状态=1
```

#### 3.5 温馨提示

更多[cron表达式](https://www.baidu.com/s?wd=cron表达式)的定义规范请自行百度！

